#!/usr/bin/perl -w
#
# Integration with debconf.

use Debian::Debhelper::Dh_Lib;
init();

foreach $PACKAGE (@{$dh{DOPACKAGES}}) {
	$TMP=tmpdir($PACKAGE);
	$config=pkgfile($PACKAGE,"config");
	$templates=pkgfile($PACKAGE,"templates");

	if (! -d "$TMP/DEBIAN") {
		doit("install","-o",0,"-g",0,"-d","$TMP/DEBIAN");
	}

	if ($config ne '') {
		doit("install", "-o", 0, "-g", 0, "-m", 755, "-p",
		     $config, "$TMP/DEBIAN/config");
	}
	
	if ($templates ne '') {
		# Are there translated templates too?
		my @trans=glob("$templates.??");
		if (@trans) {
			complex_doit("debconf-mergetemplate @trans $templates > $TMP/DEBIAN/templates");
			chmod 0644, "$TMP/DEBIAN/templates";
			chown 0, 0, "$TMP/DEBIAN/templates";
		}
		else {
			doit("install", "-o", 0, "-g", 0, "-m", 644, "-p",
			     $templates, "$TMP/DEBIAN/templates");
		}
	}

	if (($config ne ''|| $templates ne '') && ! $dh{NOSCRIPTS}) {
		autoscript($PACKAGE,"postrm","postrm-debconf");
	}
}

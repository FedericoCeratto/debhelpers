#!/usr/bin/perl -w
#
# Registration with emacsen-common.

use Debian::Debhelper::Dh_Lib;
init();

if (! defined $dh{PRIORITY}) {
	$dh{PRIORITY}=50;
}
if (! defined $dh{FLAVOR}) {
	$dh{FLAVOR}='emacs';
}

foreach $PACKAGE (@{$dh{DOPACKAGES}}) {
	$TMP=tmpdir($PACKAGE);

	$emacsen_install=pkgfile($PACKAGE,"emacsen-install");
	$emacsen_remove=pkgfile($PACKAGE,"emacsen-remove");
	$emacsen_startup=pkgfile($PACKAGE,"emacsen-startup");

	if ($emacsen_install ne '') {
		if (! -d "$TMP/usr/lib/emacsen-common/packages/install") {
			doit("install","-d","$TMP/usr/lib/emacsen-common/packages/install");
		}
		doit("install","-m0755",$emacsen_install,"$TMP/usr/lib/emacsen-common/packages/install/$PACKAGE");
	}

	if ($emacsen_remove ne '') {
		if (! -d "$TMP/usr/lib/emacsen-common/packages/remove") {
			doit("install","-d","$TMP/usr/lib/emacsen-common/packages/remove");
		}
		doit("install","-m0755","$emacsen_remove","$TMP/usr/lib/emacsen-common/packages/remove/$PACKAGE");
	}
	
	if ($emacsen_startup ne '') {
		if (! -d "$TMP/etc/$dh{FLAVOR}/site-start.d/") {
			doit("install","-d","$TMP/etc/$dh{FLAVOR}/site-start.d/");
		}
		doit("install","-m0644",$emacsen_startup,"$TMP/etc/$dh{FLAVOR}/site-start.d/$dh{PRIORITY}$PACKAGE.el");
	}

	if ($emacsen_install ne '' || $emacsen_remove ne '') {
		if (! $dh{NOSCRIPTS}) {
			autoscript($PACKAGE,"postinst","postinst-emacsen",
				"s/#PACKAGE#/$PACKAGE/");
			autoscript($PACKAGE,"prerm","prerm-emacsen",
				"s/#PACKAGE#/$PACKAGE/");
		}
	}
}	

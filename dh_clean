#!/usr/bin/perl -w
#
# Clean up $tmp and other tepmorary files generated by the
# build process.

use strict;
use Debian::Debhelper::Dh_Lib;
init();

foreach my $package (@{$dh{DOPACKAGES}}) {
	my $tmp=tmpdir($package);
	my $ext=pkgext($package);

	if (! $dh{D_FLAG}) {
		doit("rm","-f","debian/${ext}substvars",
			"debian/${ext}postinst.debhelper",
			"debian/${ext}postrm.debhelper",
			"debian/${ext}preinst.debhelper",
			"debian/${ext}prerm.debhelper");
	}
	
	doit ("rm","-rf",$tmp);
}

if (! $dh{D_FLAG}) {
	if (@ARGV) {
		doit("rm","-f","--",@ARGV);
	}

	if (! $dh{K_FLAG}) {
		doit("rm","-f","debian/files");
	}

	# See if some files that would normally be deleted are excluded.
	my $find_options='';
	if (defined($dh{EXCLUDE_FIND}) && $dh{EXCLUDE_FIND} ne '') {
		$find_options="-a ! ( $dh{EXCLUDE_FIND} )";
	}

	# Remove other temp files.
	# (The \s+ is important, \s won't work because find would get null
	# parameters). Note that you _don't_ quote wildcards used by find
	# in here.
	doit(split(/\s+/,"find . -type f -a
	        ( -name #*# -o -name *~ -o -name DEADJOE
		 -o -name *.orig -o -name *.rej -o -name *.bak
		 -o -name .*.orig -o -name .*.rej -o -name .SUMS
		 -o -name TAGS -o -name core -o ( -path */.deps/* -a -name *.P )
		) $find_options -exec rm -f {} ;"));
}

doit('rm', '-rf', 'debian/tmp') if -x 'debian/tmp' && ! compat(1);

